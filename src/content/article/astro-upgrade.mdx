---
isDraft: false
title: "Astro本体と依存関係のバージョンをアップグレードする手順と注意点"
description: "Astro本体と依存関係のパッケージをアップグレードする方法を紹介しています。また、アップグレード時の注意点に関しても説明しています。"
tags: ["astro"]
publishedAt: 2025-01-09T01:00:00Z
thumbnail: "./images/astro-upgrade/thumb.png"
---

import imgCommand from "@article/images/astro-upgrade/command.png";

Astroでは、常に最新の機能の追加やバグ修正が行われているため、定期的にバージョンアップを行うことが推奨されています。

今回の記事では、AstroやAstroに依存するパッケージのバージョンをアップグレードする手順を紹介します。

また、アップグレードする際の注意点についても解説していきます。

## 開発環境のバージョン

当記事で紹介する方法は、以下のバージョンで動作確認を行っています。

<NpmVersions versions={[{ name: "astro", version: "5.1.3" }]} />

<InfoBox type="success">
  バージョンの違いによっては、この記事の通りに動作しない可能性がありますので、ご理解いただけますと幸いです。
</InfoBox>

## Astroを最新バージョンにアップグレードする

Astroと、Astro公式のインテグレーションを最新バージョンにアップグレードするには、以下のコマンドを実行します。

<CodeHead lang="sh" />

```sh
npx @astrojs/upgrade
```

このコマンドを実行すると、Astro本体と、Astroに依存するパッケージが最新バージョンにアップグレードされます。

<ImgCaption src={imgCommand} alt="npx @astrojs/upgradeの実行結果">
  npx @astrojs/upgradeの実行結果
</ImgCaption>

依存関係にあるパッケージも自動的に更新してくれるため、便利ですね。

<Spacer />

もし手動でバージョンアップを行いたい場合は、以下のようにパッケージを個別にアップグレードすることもできます。

<CodeHead lang="sh" />

```sh
npm install astro@latest @astrojs/react@latest @astrojs/mdx@latest
```

自身のプロジェクトで使用しているパッケージに合わせてアップグレードしてください。

<Spacer />

<InfoBox>
  Astroに依存していないパッケージに関しては、自身でバージョンアップを行う必要があるので、そちらも忘れずに対応してください。
</InfoBox>

## Astroを特定のバージョンにアップグレードする

Astroを最新ではなく特定のバージョンにアップグレードする場合は、以下のようにコマンドを実行します。

<CodeHead lang="sh" />

```sh
npm install astro@4.5.3 @astrojs/react@3.0.10
```

基本的には最新バージョンでいいかと思いますが、なんらかの理由で特定のバージョンを使用したい場合は、上記のようにバージョンを指定するといいでしょう。

## Astroでバージョンアップする場合の注意点

Astroはセマンティックバージョニングを採用しており、バージョンアップはメジャー・マイナー・パッチの3つに分かれています。

- パッチレベルの変更：例）`4.5.3` → `4.5.4`
- マイナーレベルの変更：例）`4.5.x` → `4.6.x`
- メジャーレベルの変更：例）`4.x.x` → `5.x.x`

### パッチレベルの変更

パッチレベルの変更は、基本的にはほとんど影響がなく、バージョンアップを行っても問題ない場合が多いです。

主に以下のような内容が含まれます。

- Astroの内部的な変更（機能はそのまま）
- ログやエラーメッセージの改善
- 失敗したリリースの再リリース
- バグの修正

パッチレベルの変更の場合は、既存のコードを変更・修正する必要はありません。

### マイナーレベルの変更

マイナーリリースは、新しい機能の追加や改善が行われますが、既存のコードに影響を与える破壊的変更は含まれません。

- 既存の機能やオプションの非推奨化（警告のみ）
- 新しい機能やオプションの追加

こちらも既存のコードを変更する必要はなさそうですが、将来的に削除される機能が発表されるので目を通しておいた方がいいかと思います。

### メジャーレベルの変更

メジャーレベルの変更は、**既存コードに影響を与える破壊的変更が含まれる**ので、アップグレードの際には注意してください。

- 内部ロジックの大幅な変更
- 非推奨とされた機能の削除
- 既存の機能やオプションの変更
- その他の非破壊的な変更・改善など

Astroでは、**メジャーバージョンがリリースされると公式ドキュメントにアップグレードガイドが追加される**ので、必ず目を通してからアップグレードを行うようにしましょう。

## 【まとめ】Astroのバージョンアップグレード手順と注意点について

今回の記事では、Astroのバージョンアップグレード手順と注意点について解説しました。

Astro関連のパッケージは、以下のコマンドで一括アップグレードするか、個別にバージョンを指定してアップグレード可能です。

<CodeHead lang="sh" />

```sh
// 一括アップグレード
npx @astrojs/upgrade

// 個別にバージョン指定
npm install astro@4.5.3 @astrojs/react@3.0.10
```

また、アップグレードする際は、メジャー・マイナー・パッチの違いに注意して行ってください。

Astroのアップグレードに関しては公式ドキュメントに詳しく記載されているので、以下のリンクから確認してみてください。

https://docs.astro.build/ja/upgrade-astro/
